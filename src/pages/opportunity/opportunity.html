<ion-header>
  <ion-toolbar>
    <ion-navbar text-center hideBackButton="true" style="padding: 0px !important">
      <ion-grid style="padding: 0px !important">
        <ion-row align-items-center>
          <ion-col col-2>
            <img style="width: 60%" (click)="goBack()" src="assets/imgs/back_button@3x.png">
          </ion-col>
          <ion-col col-3 offset-3 style="display: flex;align-items: center">
            <img src="assets/imgs/firsat_header@3x.png" style="margin-left: -13px">
          </ion-col>
          <ion-col col-2 offset-2>
            <img style="width: 60%" src="assets/imgs/paylas_button@3x.png">
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-navbar>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-row [ngClass]="itemone ? 'toLogoUp' : 'toLogoDown'" text-center>
    <ion-col style="font-family: MarkPro-Heavy;font-size: 20px;color:#234491;margin-top: 20px" align-self-center>
      <span>{{opportunity.title}}</span>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col col-8 offset-2 style="text-align: center">
      <img src="https://app-b7b3c182-2419-47ad-a597-caf24ce3f70c.cleverapps.io/{{opportunity.image_url}}">
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col col-2 push-1 style="display: flex;align-items: center">
      <img src="assets/imgs/price_tag@3x.png">
    </ion-col>
    <ion-col col-4 push-1 style="display: flex;align-items: center">
      <ion-label [ngStyle]="{'font-size':isPriceToolong()}"
                 style="font-family: MarkPro-Black;font-size: 18px;color:#234491">{{whatIsPrice()}}
      </ion-label>
    </ion-col>
    <ion-col style="padding: 0px !important;display: flex;align-items: center;justify-content: center" col-5>
      <div style="background-color: #F7E60F;border-radius: 20px 20px 20px 20px;width: 100%">
        <ion-grid style="padding: 0px !important;">
          <ion-row style="padding: 0px !important;">
            <ion-col style="padding: 0px !important;display: flex;align-items: center" col-4>
              <img style="border-radius: 50%;width: 40px;height: 40px;" src="{{opportunity.user.avatar_url}}">
            </ion-col>
            <ion-col style="padding: 0px !important;display: flex;align-items: center" col-8>
              <span style="font-family: MarkPro-Heavy;font-size: 15px;color:#234491;word-break: normal">{{opportunity.user.name}}</span>
            </ion-col>
          </ion-row>
        </ion-grid>
      </div>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col>
      <img style="transform: scale(0.9)" src="assets/imgs/seperator_line@3x.png">
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col style="margin-left: 18px">
      <span style="font-family: MarkPro-Medium;font-size: 15px;color:#234491">{{opportunity.details}}</span>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col>
      <img style="transform: scale(0.9)" src="assets/imgs/seperator_line@3x.png">
    </ion-col>
  </ion-row>
  <ion-row align-items-center>
    <ion-col no-padding col-2 push-1>
      <div no-padding id="lottieLikeButton" (click)="playAnim(0,'like')">
        <span class="like-button-text">
          {{opportunity.votes_sum}}
        </span>
      </div>
    </ion-col>
    <ion-col col-6 push-1>
      <img (click)="onOutsideDealLink(opportunity)" src="assets/imgs/firsata_git_button@3x.png">
    </ion-col>
    <ion-col col-2 push-1>
      <img src="assets/imgs/comment_button@3x.png">
      <ion-label style="font-family: MarkPro-Heavy;font-size: 10px;position:absolute;left:61%;top:5%;color:#234491">
        {{opportunity.comments_count}}
      </ion-label>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col>
      <img style="transform: scale(0.9)" src="assets/imgs/yorumlar_header@3x.png">
    </ion-col>
  </ion-row>
  <ion-list [ngClass]="itemfour ? 'toLogoUp' : 'toLogoDown'">

  <div *ngFor="let comment of newlyAddedComments">
    <div *ngIf="newlyAddedComments.length > 0" id="newlyAdded" ngClass="highlighted">
      <div style="margin-top: 16px;background-color:#E5E5E5;border-radius: 20px 20px 20px 20px;transform: scale(0.9)">
        <ion-row style="background-color: #F7E60F;border-radius: 20px 20px 20px 20px">
          <ion-col col-2>
            <ion-avatar>
              <img style="border-radius: 20px;height: 40px;width: 40px;" src="{{comment.user.avatar_url}}">
            </ion-avatar>
          </ion-col>
          <ion-col style="padding: 0px !important;display: flex;align-items: center" col-8>
            <span style="font-family: MarkPro-Heavy;font-size: 15px;color:#234491">{{comment.user.name}}</span>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col style="margin: 5px">
        <span *ngIf="comment.showContent"
              [@onCommentExpand]="comment.showContent ? 'toExpand' : 'asd'">{{comment.text}}</span>
            <span style="font-family: MarkPro-Book;font-size: 15px;color:#234491"
                  (click)="comment.showContent = !comment.showContent"
                  *ngIf="!comment.showContent">{{comment.text}}</span>
          </ion-col>
        </ion-row>
      </div>
    </div>
  </div>

    <div *ngFor="let comment of comments;let i = index" id="{{comment.newlyAdded}}"

         ngClass="highlighted">
      <div style="margin-top: 16px;background-color:#E5E5E5;border-radius: 20px 20px 20px 20px;transform: scale(0.9)">
        <ion-row style="background-color: #F7E60F;border-radius: 20px 20px 20px 20px">
          <ion-col col-2>
            <ion-avatar>
              <img style="border-radius: 20px;height: 40px;width: 40px;" src="{{comment.user.avatar_url}}">
            </ion-avatar>
          </ion-col>
          <ion-col style="padding: 0px !important;display: flex;align-items: center" col-8>
            <span style="font-family: MarkPro-Heavy;font-size: 15px;color:#234491">{{comment.user.name}}</span>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col style="margin: 5px">
        <span *ngIf="comment.showContent"
              [@onCommentExpand]="comment.showContent ? 'toExpand' : 'asd'">{{comment.text}}</span>
            <span style="font-family: MarkPro-Book;font-size: 15px;color:#234491"
                  (click)="comment.showContent = !comment.showContent"
                  *ngIf="!comment.showContent">{{comment.text}}</span>
          </ion-col>
        </ion-row>
        <ion-row style="    margin-top: 20px;">
            <ion-col col-2 push-7>
              <img style="    position: absolute;
    top: -220%;" (click)="onCommentReply({comment:comment,opportunity:opportunity})"
                   src="assets/imgs/reply_icon@3x.png">
            </ion-col>
            <ion-col col-3 push-7>
              <div class="lottieThumbUpButton"  style="    position: absolute;
    top: -220%;" (click)="playAnim(i,'thumbsUp',comment)">
                <span class="like-text">{{comment.comment_votes_count}}</span>
              </div>
            </ion-col>

        </ion-row>
      </div>
      <div *ngFor="let subComment of comment.comments;let i=index">
        <ion-row style="padding-left: 15%" >
          <ion-col *ngIf="i<comment.showUntil" style="margin-top: 16px;background-color:#E5E5E5;border-radius: 20px 20px 20px 20px;transform: scale(0.9);padding: 0px">
            <ion-row style="background-color: #F7E60F;border-radius: 20px 20px 20px 20px">
              <ion-col col-2>
                <ion-avatar>
                  <img style="border-radius: 20px;height: 40px;width: 40px;" src="{{subComment.user.avatar_url}}">
                </ion-avatar>
              </ion-col>
              <ion-col style="padding: 0px !important;display: flex;align-items: center" col-8>
                <span style="font-family: MarkPro-Heavy;font-size: 15px;color:#234491">{{subComment.user.name}}</span>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col style="margin: 5px">
                <span *ngIf="subComment.showContent"[@onCommentExpand]="subComment.showContent ? 'toExpand' : 'asd'">{{subComment.text}}</span>
                <span style="font-family: MarkPro-Book;font-size: 15px;color:#234491"
                      (click)="subComment.showContent = !subComment.showContent"
                      *ngIf="!subComment.showContent">{{subComment.text}}</span>
              </ion-col>
            </ion-row>
          </ion-col>
        </ion-row>
        <ion-row *ngIf="i === comment.comments.length-1" style="margin-top: 2%;text-align: end;margin-top: 2%;margin-right: 20px;">
          <ion-col (click)="addSubcommentIndex(comment,i)">
            <span style="font-family: 'MarkPro-Medium';font-size: 11px;color:#234491">{{comment.dahaFazlaGetirText}}</span>
          </ion-col>
        </ion-row>
      </div>
    </div>
  </ion-list>
  <ion-infinite-scroll (ionInfinite)="doInfinite($event)" threshold="100px">
    <ion-infinite-scroll-content
      loadingSpinner="bubbles"
      loadingText="Yükleniyor...">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>

<ion-footer>
  <form #f="ngForm" (submit)="onCommentSubmit(f)">
    <ion-grid>
      <ion-row>
        <!--<ion-col col-2 style="text-align: center" align-self-center>
          <button>
            <ion-icon style="font-size: xx-large;font-weight: 900;color:#2FA4E7" name="add"></ion-icon>
          </button>
        </ion-col>-->
        <ion-col col-8>
          <ion-item no-lines>
            <ion-input required [ngModel] name="comment"
                       style="padding:0 0 0 10px;font-size:15px;background-color: #f0ecec;border-radius: 64px"
                       type="text" placeholder="Düşüncelerin neler ?"></ion-input>
          </ion-item>
        </ion-col>
        <ion-col col-2 text-center align-self-center style="background: white">
          <button type="submit"
                  [disabled]="!f.valid"
                  style="background: white">
            <img src="assets/imgs/dusuncelerin_neler_icon@3x.png">
          </button>
        </ion-col>
      </ion-row>
    </ion-grid>
  </form>
</ion-footer>
